(this.webpackJsonpchatroom=this.webpackJsonpchatroom||[]).push([[0],{124:function(e){e.exports=JSON.parse('[{"inputs":[],"name":"chatRooms","outputs":[{"components":[{"internalType":"uint256","name":"roomId","type":"uint256"},{"internalType":"address","name":"roomCreator","type":"address"},{"internalType":"string","name":"roomName","type":"string"},{"internalType":"string","name":"roomPhoto","type":"string"},{"internalType":"address[]","name":"roomMembers","type":"address[]"}],"internalType":"struct ChatRoom.Room[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_roomId","type":"uint256"}],"name":"joinRoom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_message","type":"string"},{"internalType":"uint256","name":"_roomId","type":"uint256"}],"name":"newMessage","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_roomName","type":"string"},{"internalType":"string","name":"_roomPhoto","type":"string"}],"name":"newRoom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_roomId","type":"uint256"}],"name":"roomDetails","outputs":[{"internalType":"uint256","name":"roomId","type":"uint256"},{"internalType":"address","name":"roomCreator","type":"address"},{"internalType":"string","name":"roomName","type":"string"},{"internalType":"string","name":"roomPhoto","type":"string"},{"internalType":"address[]","name":"roomMembers","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_roomId","type":"uint256"}],"name":"roomMessages","outputs":[{"components":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"string","name":"message","type":"string"},{"internalType":"uint256","name":"time","type":"uint256"}],"internalType":"struct ChatRoom.Message[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"}]')},328:function(e,t,n){},343:function(e,t){},345:function(e,t){},358:function(e,t){},359:function(e,t){},379:function(e,t){},384:function(e,t){},390:function(e,t){},392:function(e,t){},405:function(e,t){},419:function(e,t){},449:function(e,t){},450:function(e,t){},480:function(e,t){},496:function(e,t){},498:function(e,t){},511:function(e,t){},698:function(e,t,n){},699:function(e,t,n){},700:function(e,t,n){},705:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(47),c=n.n(a),s=(n(328),n(5)),o=n(21),i=n(11),u=n(120),l=n.n(u),j=n(121),m=n(101),b=n(6),d=n(90),p=n.n(d),O=n(321),h=n(1);var f=function(){return Object(h.jsx)(O.a,{animation:"border",role:"status",children:Object(h.jsx)("span",{className:"visually-hidden",children:"Loading..."})})},x=(n(698),function(e){var t=Object(b.l)(),n=function(){var n=Object(o.a)(Object(s.a)().mark((function n(r){return Object(s.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.chatroomContract.methods.joinRoom(r).send({from:e.walletAddress});case 3:t("room/".concat(r)),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),console.log(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(e){return n.apply(this,arguments)}}();return Object(h.jsx)(h.Fragment,{children:e.rooms?Object(h.jsxs)("div",{className:"chatrooms",children:[Object(h.jsx)("div",{className:"rooms-head",children:"All Public rooms"}),Object(h.jsx)("div",{className:"rooms",children:e.rooms.map((function(t){return Object(h.jsxs)("div",{className:"room-prev",children:[Object(h.jsx)("img",{src:t.roomImage}),Object(h.jsx)("div",{className:"room-name",children:t.roomName}),Object(h.jsxs)("div",{className:"room-creator",children:["Created By:",Object(h.jsx)("div",{className:"icon",children:(r=t.roomCreator,Object(h.jsx)(p.a,{diameter:50,seed:Object(d.jsNumberForAddress)(r)}))}),Object(h.jsx)("div",{className:"addr",children:e.truncateAddress(t.roomCreator)})]}),Object(h.jsxs)("div",{children:["Participants: ",t.roomMembers.length]}),Object(h.jsx)("div",{className:"room-prev-btns",children:t.roomMembers.includes(e.walletAddress)?Object(h.jsx)("button",{children:Object(h.jsx)(m.b,{to:"room/".concat(t.roomId),children:"Open"})}):Object(h.jsx)("button",{onClick:Object(o.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n(t.roomId));case 1:case"end":return e.stop()}}),e)}))),children:"Join"})})]});var r}))})]}):Object(h.jsx)(f,{})})}),v=n(124),y=(n(699),function(e){var t=Object(b.n)().id,n=Object(r.useState)(!1),a=Object(i.a)(n,2),c=a[0],u=a[1],m=Object(r.useState)([]),O=Object(i.a)(m,2),x=O[0],y=O[1],w=Object(r.useState)(null),g=Object(i.a)(w,2),N=g[0],k=g[1],T=Object(r.useState)(null),C=Object(i.a)(T,2),S=C[0],M=C[1],F=Object(r.useState)(),A=Object(i.a)(F,2),I=A[0],P=A[1],R=Object(r.useState)(),B=Object(i.a)(R,2),E=B[0],D=B[1],_=Object(r.useState)(),J=Object(i.a)(_,2),L=J[0],W=J[1],H=Object(r.useState)(),K=Object(i.a)(H,2),U=K[0],Y=K[1],q=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,n,r,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.celo){e.next=20;break}return e.prev=1,e.next=4,window.celo.enable();case 4:return t=new l.a(window.celo),n=Object(j.newKitFromWeb3)(t),e.next=8,n.web3.eth.getAccounts();case 8:r=e.sent,a=r[0],n.defaultAccount=a,P(n),D(a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.log(e.t0);case 18:e.next=21;break;case 20:alert("You need to install the celo wallet extension in order to use this app");case 21:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.getTotalBalance(E);case 3:e.sent,t=new I.web3.eth.Contract(v,"0xce42dF9622ED105728B977364F61f350d8b186c2"),W(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){q()}),[]),Object(r.useEffect)((function(){I&&E&&z()}),[I,E]);var G=function(t){if(t==e.walletAddress)return"my-msg"},Q=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var n,r,a,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u(!0),e.next=4,L.methods.roomMessages(t).call();case 4:return n=e.sent,e.next=7,Promise.all(n.map(function(){var e=Object(o.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sender:t[0],message:t[1],time:t[2]});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return r=e.sent,y(r),a=new Promise(function(){var e=Object(o.a)(Object(s.a)().mark((function e(n){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.methods.roomDetails(t).call();case 2:r=e.sent,n({roomId:r[0],roomCreator:r[1],roomName:r[2],roomPhoto:r[3],roomMembers:r[4]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=12,Promise.resolve(a);case 12:c=e.sent,M(c),u(!1),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0);case 20:return e.prev=20,u(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[0,17,20,23]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.methods.newMessage(N,t).send({from:E});case 3:n=e.sent,Y(n),k(null),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){L&&Q()}),[L,U]),Object(h.jsx)(h.Fragment,{children:!c&&S?Object(h.jsxs)("div",{className:"room",children:[Object(h.jsxs)("div",{className:"chatroom-head",children:[Object(h.jsx)("img",{src:S.roomPhoto}),Object(h.jsxs)("div",{className:"head-info",children:[Object(h.jsx)("div",{className:"head-name",children:S.roomName}),Object(h.jsxs)("div",{className:"head-m-count",children:[S.roomMembers.length," group members"]})]})]}),Object(h.jsx)("div",{className:"chatroom-main",children:x.map((function(e){return Object(h.jsx)("div",{className:"chatmessage ".concat(G(e.sender)),children:Object(h.jsxs)("div",{className:"chatmessage-body",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"chatmessage-msg",children:e.message}),Object(h.jsx)("div",{className:"chatmessage-time",children:new Date(1e3*e.time).toLocaleString()})]}),e.sender!=E&&(t=e.sender,Object(h.jsx)("a",{href:"https://alfajores-blockscout.celo-testnet.org/address/".concat(t,"/transactions"),children:Object(h.jsx)(p.a,{diameter:30,seed:Object(d.jsNumberForAddress)(t)})}))]})});var t}))}),Object(h.jsxs)("div",{className:"send",children:[Object(h.jsx)("input",{value:N,onChange:function(e){return k(e.target.value)}}),Object(h.jsx)("button",{onClick:Object(o.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",V());case 1:case"end":return e.stop()}}),e)}))),children:"Send"})]})]}):Object(h.jsx)(f,{})})}),w=(n(700),n(125)),g=n(91),N=function(e){if(e)return e.slice(0,5)+"..."+e.slice(e.length-4,e.length)};var k=function(){var e=Object(r.useState)(),t=Object(i.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(0),u=Object(i.a)(c,2),d=u[0],p=u[1],O=Object(r.useState)(),f=Object(i.a)(O,2),k=f[0],T=f[1],C=Object(r.useState)(),S=Object(i.a)(C,2),M=S[0],F=S[1],A=Object(r.useState)(),I=Object(i.a)(A,2),P=I[0],R=I[1],B=Object(r.useState)(),E=Object(i.a)(B,2),D=E[0],_=E[1],J=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,n,r,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.celo){e.next=20;break}return e.prev=1,e.next=4,window.celo.enable();case 4:return t=new l.a(window.celo),n=Object(j.newKitFromWeb3)(t),e.next=8,n.web3.eth.getAccounts();case 8:r=e.sent,c=r[0],n.defaultAccount=c,a(n),F(c),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.log(e.t0);case 18:e.next=21;break;case 20:alert("You need to install the celo wallet extension in order to use this app");case 21:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,r,a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getTotalBalance(M);case 3:t=e.sent,r=t.cUSD.shiftedBy(-18).toFixed(2),a=new n.web3.eth.Contract(v,"0xce42dF9622ED105728B977364F61f350d8b186c2"),p(r),R(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.methods.chatRooms().call();case 3:return t=e.sent,e.next=6,Promise.all(t.map(function(){var e=Object(o.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{roomId:t[0],roomCreator:t[1],roomName:t[2],roomImage:t[3],roomMembers:t[4]});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:n=e.sent,T(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(o.a)(Object(s.a)().mark((function e(t,n){var r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.methods.newRoom(t,n).send({from:M});case 3:r=e.sent,_(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){J()}),[]),Object(r.useEffect)((function(){n&&M&&L()}),[n,M]),Object(r.useEffect)((function(){P&&W()}),[P,D]);var K=function(e){var t=Object(r.useState)(!1),n=Object(i.a)(t,2),a=n[0],c=n[1],u=Object(r.useState)(),l=Object(i.a)(u,2),j=l[0],m=l[1],b=Object(r.useState)(),d=Object(i.a)(b,2),p=d[0],O=d[1],f=function(){return c(!1)};return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(w.a,{variant:"primary",onClick:function(){return c(!0)},style:{height:"60px",width:"100px",margin:"2rem"},children:"New Room"}),Object(h.jsxs)(g.a,{show:a,onHide:f,children:[Object(h.jsx)(g.a.Header,{closeButton:!0,children:Object(h.jsx)(g.a.Title,{children:"Add new chat room"})}),Object(h.jsxs)(g.a.Body,{children:[Object(h.jsx)("label",{children:"Room name"}),Object(h.jsx)("input",{value:j,onChange:function(e){return m(e.target.value)}}),Object(h.jsx)("label",{children:"Room Photo"}),Object(h.jsx)("input",{value:p,onChange:function(e){return O(e.target.value)}})]}),Object(h.jsxs)(g.a.Footer,{children:[Object(h.jsx)(w.a,{variant:"secondary",onClick:f,children:"Close"}),Object(h.jsx)(w.a,{variant:"primary",onClick:Object(o.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.addNewRoom(j,p));case 1:case"end":return t.stop()}}),t)}))),children:"Add"})]})]})]})};return Object(h.jsxs)("div",{className:"app",children:[Object(h.jsxs)("div",{className:"heading",children:[Object(h.jsx)("div",{className:"head-text",children:"Web3Chat"}),Object(h.jsx)(K,{addNewRoom:H}),Object(h.jsxs)("div",{className:"bal",children:[d," cUSD"]})]}),Object(h.jsx)(m.a,{children:Object(h.jsxs)(b.c,{children:[Object(h.jsx)(b.a,{path:"/",element:Object(h.jsx)(x,{truncateAddress:N,walletAddress:M,rooms:k,chatroomContract:P})}),Object(h.jsx)(b.a,{path:"/room/:id",element:Object(h.jsx)(y,{walletAddress:M})})]})})]})},T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,710)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};n(703);c.a.render(Object(h.jsx)(k,{}),document.getElementById("root")),T()}},[[705,1,2]]]);
//# sourceMappingURL=main.bbf1f6e7.chunk.js.map